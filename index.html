<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"> 
    <title>Adventskalender für Luisa</title>
    <style>
        /* --- 1. Layout & Responsive Design --- */
        body {
            font-family: sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden; 
        }

        h1 {
            color: #c0392b;
            margin-bottom: 30px;
            text-align: center;
            
            font-size: 6vw; 
            
            white-space: nowrap; 
            padding: 0 5px; 
            box-sizing: border-box;
        }

        #calendar {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            max-width: 1000px;
            width: 100%;
        }

        @media (max-width: 600px) {
            #calendar {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }
            h1 {
                font-size: 7vw; 
            }
        }

        /* --- 2. Tür-Stile (Unverändert) --- */
        .door {
            background-color: #27ae60;
            border: 4px solid #c0392b;
            border-radius: 10px;
            aspect-ratio: 1 / 1;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .door:hover:not(.locked) {
            transform: translateY(-3px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2);
        }

        .door-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            z-index: 2;
        }

        .door.locked {
            background-color: #95a5a6;
            cursor: default;
            opacity: 0.7;
        }
        
        .door.opened {
            background-color: #e67e22;
        }
        
        /* --- 3. Modal und Eingabe --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            overflow-y: auto;
        }

        .modal-content {
            background-color: #fff;
            margin: 15% auto;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            text-align: center;
        }
        
        /* Bild-Container Styling */
        #riddle-image-container {
            margin: 15px 0;
            display: none;
        }
        #riddle-image {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            border: 2px solid #c0392b;
        }

        .riddle-input {
            padding: 10px;
            margin: 15px auto; 
            width: 80%;
            border-radius: 5px;
            text-align: center;
            font-size: 16px; 
            -webkit-text-size-adjust: 100%; 
            display: block;
        }

        .riddle-button {
            background-color: #c0392b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        
        /* --- 4. Fortschrittsanzeige --- */
        #progress-display-container {
            margin-top: 30px;
            padding: 10px; 
            background-color: #ecf0f1;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            text-align: center;
        }
        
        #progress-display {
            font-family: monospace;
            font-size: 2em;
            letter-spacing: 0.1em;
            color: #c0392b;
            font-weight: bold;
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center;
            line-height: 1.5; 
            padding: 10px 0;
            white-space: pre-wrap; 
        }

        #final-message-text {
            color: #27ae60;
            font-size: 1.5em;
            margin-top: 10px;
            font-weight: bold;
            display: none;
        }

        #reset-button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
    </style>
</head>
<body>

    <h1>✨ Adventskalender für Luisa ✨</h1> 

    <div id="calendar">
    </div>
    
    <div id="progress-display-container">
        <div id="progress-display"></div> 
        <div id="final-message-text">LASS UNS KAKAO TRINKEN GEHEN</div>
    </div>
    <button id="reset-button" onclick="resetCalendar()">Fortschritt zurücksetzen</button>


    <div id="riddleModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2 id="modal-title">Rätsel zu Tür X</h2>
            
            <div id="riddle-content-container">
                <p id="riddle-text">Rätselfrage...</p>
                
                <div id="riddle-image-container">
                    <img id="riddle-image" src="" alt="Rätselbild">
                </div>
                
                <input type="text" id="riddle-answer" class="riddle-input" placeholder="Deine Antwort eingeben...">
            </div>
            
            <button id="submit-answer" class="riddle-button">Antwort prüfen</button>
            <p id="feedback-message" style="margin-top: 10px; font-weight: bold;"></p>
            <p id="success-message" style="margin-top: 10px; color: #27ae60; font-weight: bold; display: none;">Richtig! Tür geöffnet!</p>
        </div>
    </div>


    <script>
        // --- 1. DATEN UND INITIALISIERUNG ---
        const DISPLAY_MESSAGE = "LASS UNS KAKAO TRINKEN GEHEN "; 
        const NUM_DOORS = 24;
        const TARGET_LETTERS = "LASSUNSKAKAOTRINKENGEHEN"; 

        const allRiddles = [
            { question: "Was hat eine Zunge, aber keinen Mund, und kann doch sprechen?", answer: "lautsprecher" },
            { category: "MATH_MC", question: "Was ist $\int_0^{\pi/2} \sin(x) dx$? Wähle die Option B. Gib 'antworta' ein.", answer: "antworta" },
            { category: "LOGIC_MC", question: "Welcher Würfel passt zu diesem Netz? [BILD: Würfelnetz] - Gib das Wort 'symbolc' ein.", answer: "symbolc" },
            { category: "IMAGE", question: "Errate das Gericht auf dem Bild:", imageSrc: "Spinat lasagne.jpeg", answer: "spinatlasagne" },
            { category: "COUNTRY", question: "Zu welchem Land gehört dieser Umriss? (Umriss von Ungarn) - Gib das Land ein.", imageSrc: "Ungarn.png", answer: "ungarn" },
            { question: "Was hat zwar ein Auge, sieht aber nichts?", answer: "nadel" },
            { category: "MATH_MC", question: "Löse: $2x + 5 = 11$. (A) $x=2$, (B) $x=3$, (C) $x=4$. Wähle Option B. Gib 'summe' ein.", answer: "summe" },
            { category: "LOGIC_MC", question: "Was ist die nächste Zahl in der Folge: 2, 4, 8, 16, ... Wähle Option B (32). Gib 'Korrekt' ein.", answer: "korrekt" },
            { category: "IMAGE", question: "Erkenne den Gegenstand auf dem Bild:", imageSrc: "Apfel.jpg", answer: "apfel" },
            { category: "COUNTRY", question: "Welches Land gehört zu dieser Flagge? (Flagge von Deutschland) - Gib das Land ein.", answer: "kroatien" },
            { question: "Was ist das, was man besitzt, aber niemals anfassen kann?", answer: "alter" },
            { question: "Ich bin immer vor dir, aber du kannst mich nicht sehen. Was bin ich?", answer: "ort" },
            { category: "LOGIC_MC", question: "Wenn 5 Vögel auf einem Zaun sitzen und du 2 erschießt, wie viele bleiben übrig? (A) 0, (B) 3, (C) 5. Gib die 'T'atsächliche Antwort als Wort ein.", answer: "tatsache" },
            { category: "SEARCH", question: "Finde das versteckte Wort in diesem Rätseltext: 'Suche hier den **R**egenschirm zum Erfolg.'", answer: "regenschirm" },
            { category: "IMAGE", question: "Welches Tier ist das?", imageSrc: "Pinguin.jfif", answer: "igel" },
            { category: "MATH_MC", question: "Lösung von $\log_2(8)$? (A) 2, (B) 3, (C) 4. Wähle Option B. Gib 'numerisch' ein.", answer: "numerisch" },
            { question: "Ich habe Städte, aber keine Häuser. Ich habe Berge, aber keine Bäume. Was bin ich?", answer: "karte" },
            { category: "COUNTRY", question: "Zu welchem Land gehört dieser Umriss? (Umriss von Italien) - Gib das Land ein.", answer: "england" },
            { category: "SEARCH", question: "Zähle die Buchstaben in dem Wort, das mit 'N' beginnt, in diesem Satz: 'Hier ist die **N**ummer versteckt.'", answer: "neun" },
            { category: "IMAGE", question: "Was ist das?", imageSrc: "Eichhörnchen.jfif", answer: "gold" },
            { category: "LOGIC_MC", question: "Ein Arzt gibt dir 3 Pillen und sagt, du sollst alle 30 Minuten eine nehmen. Wie lange dauert es? Wähle Option A. Gib 'eine' ein.", answer: "eine" },
            { question: "Ich bin leicht wie eine Feder, aber der stärkste Mensch kann mich nicht länger als fünf Minuten halten. Was bin ich?", answer: "hauch" },
            { category: "MATH_MC", question: "Wie lautet die Ableitung von $f(x) = e^{3x}$? (A) $e^{3x}$, (B) $3e^{3x}$, (C) $e^{3x}/3$. Wähle Option B. Gib 'ergebnis' ein.", answer: "ergebnis" },
            { question: "Was ist voller Löcher, hält aber trotzdem Wasser?", answer: "netz" } 
        ];
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        // --- FUNKTION: ERSTELLT ZUORDNUNGEN (ENTRANDOMISIERT) ---
        function createConstrainedAssignments() {
            // FIXE ZUORDNUNG: Riddle Index 0 geht an Pos 1, Index 1 an Pos 2, etc.
            const doorAssignments = {};
            for (let i = 1; i <= NUM_DOORS; i++) {
                doorAssignments[i] = { 
                    riddleIndex: i - 1, // Index 0 -> Pos 1
                    targetPosition: i   // Pos 1 -> Lücke 1 (L)
                };
            }
            return doorAssignments;
        }

        // INITIALISIERUNG DER ZUORDNUNGEN
        let assignments = JSON.parse(localStorage.getItem('assignments'));
        if (!assignments) {
            assignments = createConstrainedAssignments();
            localStorage.setItem('assignments', JSON.stringify(assignments));
        }

        let revealedLetters = JSON.parse(localStorage.getItem('revealedLetters')) || {}; 
        let currentDoorNumber = null;
        let currentRiddle = null;


        function cleanAnswer(answer) {
            if (!answer) return "";
            return answer.toLowerCase()
                         .normalize("NFD").replace(/[\u0300-\u036f]/g, "") 
                         .replace(/[^a-z0-9]/g, '');
        }
        
        // --- 2. DATUMSLOGIK ---
        function canOpenDoor(day) {

            return true;
            
            const today = new Date(); 
            const currentMonth = today.getMonth() + 1;
            const currentDay = today.getDate();
            
            if (currentMonth !== 12) {
                return false;
            }
            return day <= currentDay;
        }

        // --- 3. RENDERN KALENDER (MODIFIZIERT) ---
        function renderCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendarEl.innerHTML = '';

            const fixedDoorOrder = [
                2, 21, 19, 3, 15, 23, 
                17, 7, 14, 10, 12, 20, 
                24, 16, 6, 18, 13, 11, 
                8, 1, 5, 4, 22, 9
            ]; 

            for (let i = 1; i <= NUM_DOORS; i++) {
                // Hier wird die angezeigte Zahl festgelegt
                const displayedNumber = fixedDoorOrder[i - 1]; 
                const currentDoorPosition = i; 

                const doorEl = document.createElement('div');
                doorEl.classList.add('door');
                doorEl.dataset.day = currentDoorPosition; 

                const numberEl = document.createElement('div');
                numberEl.classList.add('door-number');
                numberEl.textContent = displayedNumber; 
                doorEl.appendChild(numberEl);

                const assignment = assignments[currentDoorPosition];
                if (!assignment) {
                    continue;
                }
                
                const targetPosition = assignment.targetPosition;
                const isOpened = !!revealedLetters[targetPosition];
                
                if (isOpened) {
                    doorEl.classList.add('opened');
                }
                
                if (!canOpenDoor(displayedNumber) && !isOpened) {
                    doorEl.classList.add('locked');
                    doorEl.onclick = () => alert(`Tür ${displayedNumber} kannst du erst ab dem ${displayedNumber}. Dezember öffnen!`);
                } else {
                    doorEl.onclick = () => openDoor(currentDoorPosition, displayedNumber);
                }

                calendarEl.appendChild(doorEl);
            }
            
            updateProgressDisplay();
        }
        
        // --- 4. FORTSCHRITTSANZEIGE LOGIK ---
        function updateProgressDisplay() {
            const progressEl = document.getElementById('progress-display');
            const finalMessageEl = document.getElementById('final-message-text');
            
            let progressString = '';
            let letterCounter = 1; 

            for (let i = 0; i < DISPLAY_MESSAGE.length; i++) {
                const char = DISPLAY_MESSAGE[i];
                
                if (char === ' ') {
                    progressString += ' ';
                } else {
                    if (letterCounter <= NUM_DOORS && revealedLetters[letterCounter]) {
                        progressString += revealedLetters[letterCounter];
                    } else {
                        progressString += '_';
                    }
                    letterCounter++; 
                }
            }
            
            progressEl.textContent = progressString;
            
            const unlockedCount = Object.keys(revealedLetters).length;
            
            if (unlockedCount === NUM_DOORS) {
                 finalMessageEl.style.display = 'block';
                 progressEl.style.display = 'none';
                 finalMessageEl.textContent = DISPLAY_MESSAGE.trim();
            } else {
                 finalMessageEs.style.display = 'none';
                 progressEl.style.display = 'block';
            }
        }


        // --- 5. RESET FUNKTION ---
        function resetCalendar() {
            if (confirm('Bist du sicher, dass du den Fortschritt und die Zuordnungen zurücksetzen möchtest?')) {
                localStorage.removeItem('revealedLetters'); 
                localStorage.removeItem('assignments'); 
                window.location.reload(); 
            }
        }
        window.resetCalendar = resetCalendar;


        // --- 6. MODAL/SPIEL-LOGIK ---
        
        const modal = document.getElementById('riddleModal');
        const closeBtn = document.querySelector('.close-button');
        const submitBtn = document.getElementById('submit-answer');
        const answerInput = document.getElementById('riddle-answer');
        const feedbackMsg = document.getElementById('feedback-message');
        const successMsg = document.getElementById('success-message');
        const riddleImageContainer = document.getElementById('riddle-image-container');
        const riddleImage = document.getElementById('riddle-image');


        function openDoor(currentDoorPosition, displayedNumber) {
            currentDoorNumber = currentDoorPosition; 

            const assignment = assignments[currentDoorPosition]; 
            if (!assignment) {
                 return;
            }
            
            currentRiddle = allRiddles[assignment.riddleIndex]; 
            const riddleData = currentRiddle;

            const targetPosition = assignment.targetPosition; 
            const revealedLetterCandidate = riddleData.answer.toUpperCase().charAt(0);

            const isOpened = !!revealedLetters[targetPosition]; 
            const currentLetter = isOpened ? revealedLetters[targetPosition] : revealedLetterCandidate;

            if (!riddleData) {
                return;
            }
            
            // Modal vorbereiten und öffnen
            document.getElementById('modal-title').textContent = `Rätsel zu Tür ${displayedNumber}`; 
            answerInput.value = '';
            feedbackMsg.style.display = 'none';
            successMsg.style.display = 'none';

            // 6.1: Wenn Tür bereits geöffnet
            if (isOpened) {
                document.getElementById('modal-title').textContent = `Tür ${displayedNumber} (Löst Position ${targetPosition} mit Buchstabe "${currentLetter}")`;
                document.getElementById('riddle-text').innerHTML = "Du hast dieses Rätsel bereits gelöst. Hier ist nochmal die Frage:";
                document.getElementById('riddle-text').innerHTML += `<br><strong>${riddleData.question}</strong>`;
                answerInput.style.display = 'none';
                submitBtn.style.display = 'none';
                riddleImageContainer.style.display = 'none';
                successMsg.textContent = `Tür ist geöffnet! Der Buchstabe "${currentLetter}" auf Position ${targetPosition} ist sichtbar.`;
                successMsg.style.display = 'block';
                modal.style.display = 'block';
                return;
            }
            
            // 6.2: Modal-Inhalt dynamisch rendern
            document.getElementById('riddle-text').innerHTML = riddleData.question;
            
            // Textfeld und Submit Button anzeigen
            answerInput.style.display = 'block';
            submitBtn.style.display = 'block';

            // Bild anzeigen, wenn vorhanden
            if (riddleData.imageSrc) {
                riddleImage.src = riddleData.imageSrc;
                riddleImageContainer.style.display = 'block';
            } else {
                riddleImageContainer.style.display = 'none';
            }

            modal.style.display = 'block';
            answerInput.focus();
        }

        function checkAnswer() {
            if (currentDoorNumber === null || !currentRiddle) return;
            
            const riddleData = currentRiddle;
            const assignment = assignments[currentDoorNumber];
            const targetPosition = assignment.targetPosition; 
            
            const userAnswer = cleanAnswer(answerInput.value);
            const correctAnswer = cleanAnswer(riddleData.answer); 
            
            const revealedLetter = riddleData.answer.toUpperCase().charAt(0);

            if (userAnswer === correctAnswer) {
                processCorrectAnswer(targetPosition, revealedLetter);
            } else {
                feedbackMsg.textContent = 'Falsche Antwort. Versuch es nochmal!';
                feedbackMsg.style.color = '#c0392b';
                feedbackMsg.style.display = 'block';
                successMsg.style.display = 'none';
            }
        }
        
        // Zentrale Logik zur Verarbeitung einer richtigen Antwort
        function processCorrectAnswer(targetPosition, revealedLetter) {
            feedbackMsg.style.display = 'none';
            successMsg.style.display = 'block';
            
            if (!revealedLetters[targetPosition]) {
                revealedLetters[targetPosition] = revealedLetter;
                localStorage.setItem('revealedLetters', JSON.stringify(revealedLetters));
                
                const doorEl = document.querySelector(`.door[data-day="${currentDoorNumber}"]`);
                if (doorEl) {
                    doorEl.classList.remove('locked');
                    doorEl.classList.add('opened');
                }
                
                successMsg.textContent = `Richtig! Der Buchstabe "${revealedLetter}" wurde auf Position ${targetPosition} freigeschaltet.`;
                updateProgressDisplay(); 
            }
            
            setTimeout(() => { modal.style.display = 'none'; renderCalendar(); }, 2000); 
        }

        
        // --- 7. EVENT-LISTENER ---
        
        closeBtn.onclick = function() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        }
        
        submitBtn.onclick = checkAnswer;
        
        answerInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        document.addEventListener('DOMContentLoaded', renderCalendar);
        
        // --- 8. SCROLL-RESET FUNKTION ---
        function resetScrollPosition() {
            window.scrollTo(0, 0);
        }
        window.addEventListener('load', resetScrollPosition);
    </script>
</body>
</html>

